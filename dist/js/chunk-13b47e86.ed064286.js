(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-13b47e86"],{"4f9e":function(e,t,r){"use strict";r("53d0")},"53d0":function(e,t,r){},"94da":function(e,t,r){},a451:function(e,t,r){var i=function(e){"use strict";var t,r=Object.prototype,i=r.hasOwnProperty,n=Object.defineProperty||function(e,t,r){e[t]=r.value},a="function"===typeof Symbol?Symbol:{},o=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",l=a.toStringTag||"@@toStringTag";function c(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch($){c=function(e,t,r){return e[t]=r}}function u(e,t,r,i){var a=t&&t.prototype instanceof v?t:v,o=Object.create(a.prototype),s=new z(i||[]);return n(o,"_invoke",{value:P(e,r,s)}),o}function m(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch($){return{type:"throw",arg:$}}}e.wrap=u;var p="suspendedStart",d="suspendedYield",f="executing",g="completed",h={};function v(){}function b(){}function y(){}var w={};c(w,o,(function(){return this}));var k=Object.getPrototypeOf,_=k&&k(k(C([])));_&&_!==r&&i.call(_,o)&&(w=_);var x=y.prototype=v.prototype=Object.create(w);function O(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function F(e,t){function r(n,a,o,s){var l=m(e[n],e,a);if("throw"!==l.type){var c=l.arg,u=c.value;return u&&"object"===typeof u&&i.call(u,"__await")?t.resolve(u.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(u).then((function(e){c.value=e,o(c)}),(function(e){return r("throw",e,o,s)}))}s(l.arg)}var a;function o(e,i){function n(){return new t((function(t,n){r(e,i,t,n)}))}return a=a?a.then(n,n):n()}n(this,"_invoke",{value:o})}function P(e,t,r){var i=p;return function(n,a){if(i===f)throw new Error("Generator is already running");if(i===g){if("throw"===n)throw a;return E()}r.method=n,r.arg=a;while(1){var o=r.delegate;if(o){var s=L(o,r);if(s){if(s===h)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(i===p)throw i=g,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);i=f;var l=m(e,t,r);if("normal"===l.type){if(i=r.done?g:d,l.arg===h)continue;return{value:l.arg,done:r.done}}"throw"===l.type&&(i=g,r.method="throw",r.arg=l.arg)}}}function L(e,r){var i=r.method,n=e.iterator[i];if(n===t)return r.delegate=null,"throw"===i&&e.iterator["return"]&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==i&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+i+"' method")),h;var a=m(n,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,h;var o=a.arg;return o?o.done?(r[e.resultName]=o.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,h):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,h)}function I(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function j(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function z(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(I,this),this.reset(!0)}function C(e){if(e||""===e){var r=e[o];if(r)return r.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var n=-1,a=function r(){while(++n<e.length)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}function E(){return{value:t,done:!0}}return b.prototype=y,n(x,"constructor",{value:y,configurable:!0}),n(y,"constructor",{value:b,configurable:!0}),b.displayName=c(y,l,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===b||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,y):(e.__proto__=y,c(e,l,"GeneratorFunction")),e.prototype=Object.create(x),e},e.awrap=function(e){return{__await:e}},O(F.prototype),c(F.prototype,s,(function(){return this})),e.AsyncIterator=F,e.async=function(t,r,i,n,a){void 0===a&&(a=Promise);var o=new F(u(t,r,i,n),a);return e.isGeneratorFunction(r)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},O(x),c(x,l,"Generator"),c(x,o,(function(){return this})),c(x,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=Object(e),r=[];for(var i in t)r.push(i);return r.reverse(),function e(){while(r.length){var i=r.pop();if(i in t)return e.value=i,e.done=!1,e}return e.done=!0,e}},e.values=C,z.prototype={constructor:z,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(j),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0],t=e.completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(i,n){return s.type="throw",s.arg=e,r.next=i,n&&(r.method="next",r.arg=t),!!n}for(var a=this.tryEntries.length-1;a>=0;--a){var o=this.tryEntries[a],s=o.completion;if("root"===o.tryLoc)return n("end");if(o.tryLoc<=this.prev){var l=i.call(o,"catchLoc"),c=i.call(o,"finallyLoc");if(l&&c){if(this.prev<o.catchLoc)return n(o.catchLoc,!0);if(this.prev<o.finallyLoc)return n(o.finallyLoc)}else if(l){if(this.prev<o.catchLoc)return n(o.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return n(o.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&i.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var a=n;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,h):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),h},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),j(r),h}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var i=r.completion;if("throw"===i.type){var n=i.arg;j(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(e,r,i){return this.delegate={iterator:C(e),resultName:r,nextLoc:i},"next"===this.method&&(this.arg=t),h}},e}(e.exports);try{regeneratorRuntime=i}catch(n){"object"===typeof globalThis?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},a8a1:function(e,t,r){"use strict";function i(e,t,r,i,n,a,o){try{var s=e[a](o),l=s.value}catch(c){return void r(c)}s.done?t(l):Promise.resolve(l).then(i,n)}function n(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function s(e){i(o,n,a,s,l,"next",e)}function l(e){i(o,n,a,s,l,"throw",e)}s(void 0)}))}}r.d(t,"a",(function(){return n}))},ac89:function(e,t,r){"use strict";r.r(t);r("a450");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"act-item app-container"},[t("el-card",[t("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"活动名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"活动名称"},model:{value:e.ruleForm.name,callback:function(t){e.$set(e.ruleForm,"name",t)},expression:"ruleForm.name"}})],1),t("el-form-item",{attrs:{label:"活动标题",prop:"name"}},[t("el-input",{attrs:{placeholder:"活动标题"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),t("el-form-item",{attrs:{label:"活动门店",prop:"store"}},[t("el-button",{attrs:{type:"text"},on:{click:e.addBranch}},[e._v("添加门店")]),t("div",{staticClass:"branch-list"},e._l(e.ruleForm.store,(function(r,i){return t("div",{key:i,staticClass:"branch-item"},[t("el-input",{staticClass:"mr10",staticStyle:{width:"40%"},attrs:{placeholder:"门店名称"},model:{value:r.name,callback:function(t){e.$set(r,"name",t)},expression:"item.name"}}),t("el-input",{staticClass:"mr10",attrs:{placeholder:"门店地址"},model:{value:r.address,callback:function(t){e.$set(r,"address",t)},expression:"item.address"}}),t("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.deleteBranch(i)}}},[e._v("删除")])],1)})),0)],1),t("el-form-item",{attrs:{label:"抽奖次数",prop:"store"}},[t("el-input",{attrs:{placeholder:"请输入抽奖次数"},model:{value:e.ruleForm.draw_count,callback:function(t){e.$set(e.ruleForm,"draw_count",t)},expression:"ruleForm.draw_count"}})],1),t("el-form-item",{attrs:{label:"活动状态"}},[t("el-radio",{attrs:{label:"1"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v("进行中")]),t("el-radio",{attrs:{label:"2"},model:{value:e.ruleForm.status,callback:function(t){e.$set(e.ruleForm,"status",t)},expression:"ruleForm.status"}},[e._v("已结束")])],1),t("el-form-item",{attrs:{label:"活动背景图片",prop:"background"}},[t("el-button",{on:{click:e.pickerBg}},[e._v("选择图片")]),t("br"),e.ruleForm.background?t("el-image",{staticClass:"bg-img",attrs:{"preview-src-list":[e.imageBaseUrl+e.ruleForm.background],src:e.imageBaseUrl+e.ruleForm.background,alt:""}}):e._e()],1),t("el-form-item",{attrs:{label:"活动头部logo",prop:"logo"}},[t("el-button",{on:{click:e.pickerLogo}},[e._v("选择图片")]),t("br"),e.ruleForm.logo?t("el-image",{staticClass:"logo-img",attrs:{"preview-src-list":[e.imageBaseUrl+e.ruleForm.logo],src:e.imageBaseUrl+e.ruleForm.logo,alt:""}}):e._e()],1),t("el-form-item",{attrs:{label:"活动底部信息",prop:"footImage"}},[t("el-button",{on:{click:e.pickerFootImage}},[e._v("选择图片")]),t("br"),e.ruleForm.footImage?t("el-image",{staticClass:"foot-img",attrs:{"preview-src-list":[e.imageBaseUrl+e.ruleForm.footImage],src:e.imageBaseUrl+e.ruleForm.footImage,alt:""}}):e._e()],1),t("el-form-item",{attrs:{label:"奖品信息"}},[t("div",{staticClass:"prize-list"},[t("table",{staticClass:"prize-list-table w100"},[t("tr",[t("th",[e._v("奖品名称")]),t("th",[e._v("奖品概率")]),t("th",[e._v("奖品库存")]),t("th",[e._v("奖品图片")]),t("th",[e._v("兑奖图片")]),t("th",[e._v("操作")])]),e._l(e.prizes,(function(r,i){return t("tr",{key:i},[t("td",{attrs:{width:"200"}},[t("el-input",{attrs:{placeholder:"奖品名称"},model:{value:r.prize_name,callback:function(t){e.$set(r,"prize_name",t)},expression:"prize.prize_name"}})],1),t("td",{attrs:{width:"120"}},[t("el-input",{attrs:{placeholder:"奖品概率"},model:{value:r.win_probability,callback:function(t){e.$set(r,"win_probability",t)},expression:"prize.win_probability"}})],1),t("td",{attrs:{width:"120"}},[t("el-input",{attrs:{placeholder:"奖品库存"},model:{value:r.stock,callback:function(t){e.$set(r,"stock",t)},expression:"prize.stock"}})],1),t("td",{attrs:{align:"center"}},[t("div",{staticClass:"image-box",on:{click:function(t){return e.addPrizeImage(r,i)}}},[r.prize_image?t("img",{attrs:{src:e.imageBaseUrl+r.prize_image,alt:""}}):t("i",{staticClass:"el-icon-upload2"})])]),t("td",{attrs:{align:"center"}},[t("div",{staticClass:"image-box",on:{click:function(t){return e.addRedemptImage(r,i)}}},[r.redemption_image?t("img",{attrs:{src:e.imageBaseUrl+r.redemption_image,alt:""}}):t("i",{staticClass:"el-icon-upload2"})])]),t("td",{attrs:{align:"center",width:"80"}},[t("el-button",{attrs:{type:"text",icon:"el-icon-delete"},on:{click:function(t){return e.removePrize(i)}}},[e._v("删除")])],1)])}))],2),t("div",{staticClass:"pl10"},[t("el-button",{on:{click:e.addPrize}},[e._v("添加奖品")])],1)])]),t("el-form-item",[t("el-button",{attrs:{loading:e.subLoading,type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("\n          "+e._s(e.activeId?"立即修改":"立即创建")+"\n        ")])],1)],1)],1),t("ImagePicker",{attrs:{visible:e.imagePickerVisible,imagePickerOpt:e.imagePickerOpt},on:{"update:visible":function(t){e.imagePickerVisible=t},confirm:e.imageConfirm}})],1)},n=[],a=(r("ac67"),r("32ea"),r("8dee"),r("cf99")),o=(r("1bc7"),r("fc02"),r("b775")),s=(r("aa18"),r("982e"),function(){var e=this,t=e._self._c;return t("el-dialog",{attrs:{title:"选择图片",visible:e.dialogVisible,width:"720px","before-close":e.beforeClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[t("div",{staticClass:"image-handle mb12"},[t("el-upload",{ref:"upload",attrs:{action:"/uploadImage","auto-upload":!1,accept:"image/*","on-success":e.uploadSuccess}},[t("el-button",{attrs:{slot:"trigger",type:"primary"},slot:"trigger"},[e._v("选取图片")]),t("el-button",{staticClass:"ml10",attrs:{type:"success"},on:{click:e.submitUpload}},[e._v("上传到服务器")])],1)],1),t("div",{staticClass:"image-list-wrapper"},[t("div",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.loadImage,expression:"loadImage"}],staticClass:"image-list mt16",attrs:{"infinite-scroll-disabled":e.disabled,"infinite-scroll-distance":"1"}},e._l(e.imageList,(function(r,i){return t("div",{key:i,staticClass:"image-item",on:{click:function(t){return e.getImg(r)}}},[t("div",{staticClass:"image-area",class:e.selectedImage.includes(r)?"selected":""},[t("img",{staticClass:"image",attrs:{src:e.imageBaseUrl+r,alt:""}})]),t("div",{staticClass:"name over1",attrs:{title:r.replace("uploads/","")}},[e._v(e._s(r.replace("uploads/","")))])])})),0),e.loading?t("p",{staticClass:"mt12 text-center"},[e._v("加载中...")]):e._e(),e.noMore?t("p",{staticClass:"mt12 text-center"},[e._v("没有更多了")]):e._e()]),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{attrs:{type:"primary",disabled:0==e.selectedImage.length},on:{click:e.confirm}},[e._v("确 定")])],1)])}),l=[],c=r("d7a8"),u=(r("a451"),r("a8a1")),m="/",p={data:function(){return{imageBaseUrl:m,imageList:[],selectedImage:[],page:0,limit:18,loading:!1,noMore:!1}},props:{visible:{type:Boolean,default:!1},imagePickerOpt:{type:Object,default:function(){}}},computed:{dialogVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},disabled:function(){return this.loading||this.noMore}},methods:{loadImage:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:this.loading=!0,this.page++,Object(o["a"])({url:"/images",params:{page:this.page}}).then((function(e){0==e.files.length&&(t.noMore=!0),t.imageList=[].concat(Object(c["a"])(t.imageList),Object(c["a"])(e.files)),t.loading=!1}));case 3:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),getImg:function(e){this.selectedImage=[e]},confirm:function(){this.$emit("confirm",this.selectedImage,this.imagePickerOpt)},submitUpload:function(){this.$refs.upload.submit()},uploadSuccess:function(){this.imageList=[],this.page=0,this.noMore=!1,this.loadImage()},beforeClose:function(e){this.selectedImage=[],e()}}},d=p,f=(r("4f9e"),r("be6a")),g=Object(f["a"])(d,s,l,!1,null,"64aaabb4",null),h=g.exports;function v(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,i)}return r}function b(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?v(Object(r),!0).forEach((function(t){Object(a["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):v(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var y={data:function(){return{imageBaseUrl:m,loading:!1,subLoading:!1,ruleForm:{name:"",title:"",store:[],background:"",logo:"",footImage:"",draw_count:"",status:"1"},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],title:[{required:!0,message:"请输入活动标题",trigger:"blur"}],store:[{required:!0,message:"请输入活动门店",trigger:"blur"}],draw_count:[{required:!0,message:"请输入抽奖次数",trigger:"blur"}],logo:[{required:!0,message:"请选择logo",trigger:"change"}],background:[{required:!0,message:"请选择背景图片",trigger:"change"}]},prizes:[{prize_name:"",prize_image:null,redemption_image:null,stock:0,win_probability:0}],imagePickerVisible:!1,imagePickerOpt:{}}},computed:{activeId:function(){return this.$route.query.id}},components:{ImagePicker:h},created:function(){this.activeId&&this.getActInfo()},methods:{addBranch:function(){this.ruleForm.store.push({name:"",address:""})},deleteBranch:function(e){this.ruleForm.store.splice(e,1)},getActInfo:function(){var e=this;this.loading=!0,Object(o["a"])("/activity/"+this.activeId+"?type=1").then((function(t){e.loading=!1;var r=t.store.split(",").map((function(e){var t=e.split("-");return{name:t[0],address:t[1]}}));console.log(r),e.ruleForm={name:t.name,title:t.title,store:r,logo:t.logo,draw_count:t.draw_count,background:t.background,footImage:t.footImage,status:t.status},e.prizes=t.prizes}))},addPrizeImage:function(e,t){this.imagePickerVisible=!0,this.imagePickerOpt={index:t,type:"prize_image"}},addRedemptImage:function(e,t){this.imagePickerVisible=!0,this.imagePickerOpt={index:t,type:"redemption_image"}},pickerBg:function(){this.imagePickerVisible=!0,this.imagePickerOpt={type:"background"}},pickerLogo:function(){this.imagePickerVisible=!0,this.imagePickerOpt={type:"logo"}},pickerFootImage:function(){this.imagePickerVisible=!0,this.imagePickerOpt={type:"footImage"}},addPrize:function(){this.prizes.push({prize_name:"",prize_image:null,redemption_image:null,win_probability:0,stock:0})},removePrize:function(e){this.prizes.splice(e,1)},imageConfirm:function(e,t){var r=t.index,i=t.type,n=e[0];void 0!==r?this.prizes[r][i]=n:this.$set(this.ruleForm,i,n),this.imagePickerVisible=!1},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(e){var r="";t.ruleForm.store.forEach((function(e){r+="".concat(e.name,"-").concat(e.address,",")}));var i=b(b({},t.ruleForm),{},{store:r.slice(0,-1),prizes:t.prizes}),n=t.activeId;t.subLoading=!0,n?o["a"].put("/activity/"+n,i).then((function(e){t.subLoading=!1,200==e.code?(t.$message.success("修改成功"),t.$router.replace("/actlist/index")):t.$message.error(e.error)})):o["a"].post("/create-activity",i).then((function(e){t.subLoading=!1,200==e.code?(t.$message.success("添加成功"),t.$router.replace("/actlist/index")):t.$message.error(e.error)}))}}))}}},w=y,k=(r("c123"),Object(f["a"])(w,i,n,!1,null,"e034628c",null));t["default"]=k.exports},c123:function(e,t,r){"use strict";r("94da")}}]);